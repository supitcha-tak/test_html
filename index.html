<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö WebView Bridge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .status {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.checking {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.not-connected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 15px 20px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .close-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .toast-btn {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .back-btn {
            background: linear-gradient(45deg, #339af0, #228be6);
            color: white;
        }
        
        .info-btn {
            background: linear-gradient(45deg, #ffd43b, #fab005);
            color: #333;
        }
        
        .test-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 14px;
        }
        
        .log-item:last-child {
            border-bottom: none;
        }
        
        .emoji {
            font-size: 20px;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåâ WebView Bridge Test</h1>
        <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏Å‡∏±‡∏ö Flutter App</p>
        
        <div id="status" class="status checking">
            üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
        </div>
        
        <div class="button-grid">
            <button class="close-btn" onclick="testRegisterSuccess()">
                <span class="emoji">‚úÖ</span>
                ‡∏™‡πà‡∏á {\"success\":true,\"open_page\":\"TICKET\"}
            </button>
            
            <button class="toast-btn" onclick="testShowToast()">
                <span class="emoji">üí¨</span>
                ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Toast
            </button>
            
            <button class="back-btn" onclick="testGoBack()">
                <span class="emoji">‚¨ÖÔ∏è</span>
                ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô
            </button>
            
            <button class="info-btn" onclick="testAppInfo()">
                <span class="emoji">‚ÑπÔ∏è</span>
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏õ
            </button>
        </div>
        
        <div class="test-section">
            <h3>üìã Test Logs</h3>
            <div id="logs" class="logs"></div>
            <button onclick="clearLogs()" style="margin-top: 10px; padding: 8px 15px; background: #6c757d; color: white;">
                üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Logs
            </button>
        </div>
    </div>

    <script>
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let isFlutterConnected = false;
        let logCount = 0;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log
        function addLog(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString('th-TH');
            const logContainer = document.getElementById('logs');
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            
            const typeEmoji = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            
            logItem.innerHTML = `${typeEmoji[type]} [${timestamp}] ${message}`;
            logContainer.appendChild(logItem);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á logs
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            logCount = 0;
            addLog('Logs ‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ Flutter ‡∏û‡∏£‡πâ‡∏≠‡∏°
        window.onFlutterReady = function() {
            isFlutterConnected = true;
            const statusEl = document.getElementById('status');
            statusEl.className = 'status connected';
            statusEl.innerHTML = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Flutter ‡πÅ‡∏•‡πâ‡∏ß';
            addLog('Flutter Bridge ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á {\"success\":true,\"open_page\":\"TICKET\"} callback
        function testRegisterSuccess() {
            addLog('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á {\"success\":true,\"open_page\":\"TICKET\"} callback...', 'info');
            
            if (typeof window.closeApp === 'function') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ window.closeApp() ‡∏û‡∏£‡πâ‡∏≠‡∏° {\"success\":true,\"open_page\":\"TICKET\"}', 'success');
                // ‡∏™‡πà‡∏á {\"success\":true,\"open_page\":\"TICKET\"} ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                if (typeof window.sendCallback === 'function') {
                    window.sendCallback('{\"success\":true,\"open_page\":\"TICKET\"}');
                } else {
                    // fallback: ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô closeApp parameter ‡∏´‡∏£‡∏∑‡∏≠ global callback
                    window.closeApp('{\"success\":true,\"open_page\":\"TICKET\"}');
                }
            } else if (typeof FlutterApp !== 'undefined') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ FlutterApp.postMessage("{\"success\":true,\"open_page\":\"TICKET\"}")', 'success');
                FlutterApp.postMessage('{\"success\":true,\"open_page\":\"TICKET\"}');
            } else {
                addLog('‡πÑ‡∏°‡πà‡∏û‡∏ö Flutter Bridge - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥', 'warning');
                alert('üì± ‡∏™‡πà‡∏á Callback: {\"success\":true,\"open_page\":\"TICKET\"}');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏™‡∏î‡∏á Toast
        function testShowToast() {
            const messages = [
                '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå! üëã',
                'Toast Message ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! üéâ',
                'WebView Bridge ‡πÄ‡∏à‡πã‡∏á‡∏°‡∏≤‡∏Å! ‚ö°',
                '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö üì±'
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            addLog(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Toast: "${randomMessage}"`, 'info');
            
            if (typeof window.showToast === 'function') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ window.showToast()', 'success');
                window.showToast(randomMessage);
            } else if (typeof FlutterApp !== 'undefined') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ FlutterApp.postMessage("toast:...")', 'success');
                FlutterApp.postMessage('toast:' + randomMessage);
            } else {
                addLog('‡πÑ‡∏°‡πà‡∏û‡∏ö Flutter Bridge - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥', 'warning');
                alert('üì± Toast: ' + randomMessage);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô
        function testGoBack() {
            addLog('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô...', 'info');
            if (typeof window.goBack === 'function') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ window.goBack()', 'success');
                window.goBack();
            } else if (typeof FlutterApp !== 'undefined') {
                addLog('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ FlutterApp.postMessage("back")', 'success');
                FlutterApp.postMessage('back');
            } else {
                addLog('‡πÑ‡∏°‡πà‡∏û‡∏ö Flutter Bridge - ‡πÉ‡∏ä‡πâ history.back() ‡πÅ‡∏ó‡∏ô', 'warning');
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    alert('üîô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö');
                }
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏õ
        function testAppInfo() {
            const userAgent = navigator.userAgent;
            const isWebView = userAgent.includes('wv') || 
                             typeof FlutterApp !== 'undefined' || 
                             typeof window.flutter_inappwebview !== 'undefined';
            
            let info = `
üåê User Agent: ${userAgent}
üì± Is WebView: ${isWebView ? 'Yes' : 'No'}
üîó Flutter Connected: ${isFlutterConnected ? 'Yes' : 'No'}
üìè Screen: ${window.screen.width}x${window.screen.height}
ü™ü Window: ${window.innerWidth}x${window.innerHeight}
            `.trim();
            
            addLog('‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏õ', 'info');
            alert(info);
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        function checkConnection() {
            setTimeout(function() {
                if (!isFlutterConnected) {
                    const statusEl = document.getElementById('status');
                    if (typeof FlutterApp !== 'undefined') {
                        statusEl.className = 'status connected';
                        statusEl.innerHTML = '‚ö° ‡∏û‡∏ö FlutterApp (‡∏£‡∏≠ JavaScript Bridge)';
                        addLog('‡∏û‡∏ö FlutterApp ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ inject functions', 'warning');
                    } else {
                        statusEl.className = 'status not-connected';
                        statusEl.innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Flutter WebView';
                        addLog('‡πÑ‡∏°‡πà‡∏û‡∏ö FlutterApp - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥', 'error');
                    }
                }
            }, 2000);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', function() {
            addLog('‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', 'info');
            checkConnection();
        });

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Flutter functions ‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        const checkInterval = setInterval(function() {
            if (typeof window.closeApp === 'function' && !isFlutterConnected) {
                window.onFlutterReady && window.onFlutterReady();
                clearInterval(checkInterval);
            }
        }, 1000);

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ focus/blur
        window.addEventListener('focus', function() {
            addLog('‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö focus', 'info');
        });

        window.addEventListener('blur', function() {
            addLog('‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢ focus', 'info');
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô logs
        addLog('üöÄ WebView Bridge Test ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
    </script>
</body>
</html>
